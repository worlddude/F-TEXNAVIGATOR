<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>Supabase Scanner</title>
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; background: #000; color: #fff; }
        #interactive.viewport { width: 100%; height: 60vh; background: #222; position: relative; }
        #interactive.viewport video { width: 100%; height: 100%; object-fit: cover; }
        canvas.drawingBuffer { position: absolute; left: 0; top: 0; }
        .ui-container { flex: 1; padding: 20px; background: #fff; color: #000; border-radius: 20px 20px 0 0; }
        .btn { width: 100%; padding: 15px; background: #2563eb; color: #fff; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        #status { text-align: center; color: #2563eb; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

    <div id="interactive" class="viewport"></div>

    <div class="ui-container">
        <div id="status">Klar til scan...</div>
        
        <div id="addForm">
            <input type="text" id="barcodeInput" placeholder="Stregkode" readonly>
            <input type="text" id="nameInput" placeholder="Varens navn">
            <button class="btn" id="saveBtn">ðŸ’¾ Gem i Supabase</button>
        </div>
        <p style="color: #666; font-size: 12px; text-align: center; margin-top: 10px;">
            Hvis kameraet ikke starter: Tjek Chrome indstillinger for kamera-adgang.
        </p>
    </div>

<script>
    // 1. OpsÃ¦tning med dine nÃ¸gler fra din fil
    const SUPABASE_URL = 'https://lpcygniycyffeswzrnms.supabase.co/'; 
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxwY3lnbml5Y3lmZmVzd3pybm1zIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwODA5NDIsImV4cCI6MjA3MjY1Njk0Mn0.4bVTsLEwvjyPllLU1-U2vcw3yHkzqj69TZOfuJvSvDQ';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY); [cite: 4]

    const status = document.getElementById('status');
    const barcodeInput = document.getElementById('barcodeInput');
    const nameInput = document.getElementById('nameInput');

    // 2. Start scanner med prÃ¦cis samme config som din fungerende fil
    function startScanner() {
        Quagga.init({
            inputStream: {
                name: "Live",
                type: "LiveStream",
                target: document.querySelector('#interactive'),
                constraints: {
                    facingMode: "environment" // Tvinger bagkamera 
                }
            },
            decoder: {
                readers: ['ean_reader', 'upc_reader', 'code_128_reader'] [cite: 14]
            },
            locate: true [cite: 14]
        }, (err) => {
            if (err) {
                status.innerText = "Fejl: " + err;
                console.error(err);
                return;
            }
            Quagga.start();
        });

        Quagga.onDetected((result) => {
            const code = result.codeResult.code; [cite: 14]
            barcodeInput.value = code;
            status.innerText = "KODE FUNDET!";
            status.style.color = "green";
            if (navigator.vibrate) navigator.vibrate(200);
            nameInput.focus();
        });
    }

    // 3. Gem funktion
    document.getElementById('saveBtn').addEventListener('click', async () => {
        const barcode = barcodeInput.value;
        const name = nameInput.value;

        if (!name || !barcode) return alert("Scan en kode og skriv et navn");

        status.innerText = "Gemmer...";

        const { error } = await supabaseClient
            .from('items') // SÃ¸rg for at tabellen hedder 'items' som i din SQL [cite: 13]
            .upsert({ barcode: barcode, name: name }); [cite: 13]

        if (error) {
            alert("Fejl: " + error.message);
        } else {
            alert("Vare gemt!");
            barcodeInput.value = "";
            nameInput.value = "";
            status.innerText = "Klar til nÃ¦ste scan...";
            status.style.color = "#2563eb";
        }
    });

    // Start ved load
    window.addEventListener('load', startScanner);
</script>
</body>
</html>
