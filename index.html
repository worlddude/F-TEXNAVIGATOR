<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barcode Scanner</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: start;
      padding: 16px;
    }
    .card {
      background: #111827;
      border-radius: 16px;
      padding: 16px;
      max-width: 640px;
      width: 100%;
      box-shadow: 0 10px 25px rgba(0,0,0,.3);
    }
    h1 { font-size: 1.25rem; margin: 0 0 8px; }
    p { color: #9ca3af; margin: 8px 0 16px; }
    video { width: 100%; border-radius: 12px; background: #000; }
    button, select, input[type="checkbox"] {
      appearance: none;
      border: 1px solid #334155;
      background: #0b1220;
      color: #e5e7eb;
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 14px;
      cursor: pointer;
    }
    button.primary { background: #064e3b; border-color: #065f46; }
    button.danger { background: #3f0b0b; border-color: #7f1d1d; }
    .result {
      margin-top: 12px;
      background: #0b1220;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 12px;
      font-family: monospace;
      word-break: break-all;
    }
    .footer { color: #9ca3af; font-size: 12px; text-align: center; margin-top: 10px; }
  </style>
  <script defer src="https://unpkg.com/@zxing/browser@latest"></script>
</head>
<body>
  <div class="card">
    <h1>üì¶ Barcode Scanner</h1>
    <p>Point your camera at a barcode (EAN-13 supported) and see the value below.</p>

    <video id="video" playsinline muted></video>

    <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap">
      <button id="start" class="primary">‚ñ∂Ô∏è Start camera</button>
      <button id="stop" class="danger" disabled>‚èπÔ∏è Stop</button>
      <button id="copy" disabled>üìã Copy</button>
    </div>

    <div class="result" id="result">No code yet</div>
    <div class="footer">Runs fully in your browser. Works best over HTTPS (GitHub Pages).</div>
  </div>

  <script>
    (function(){
      const el = id => document.getElementById(id);
      const $video = el('video');
      const $start = el('start');
      const $stop = el('stop');
      const $copy = el('copy');
      const $result = el('result');

      let zxingReader = null;
      let active = false;

      const constraints = {
        video: {
          facingMode: { ideal: 'environment' },
          width: { ideal: 1920 },
          height: { ideal: 1080 }
        },
        audio: false
      };

      async function startCamera(){
        if (!window.ZXing || !ZXing.BrowserMultiFormatReader){
          alert('ZXing not loaded. Check your connection.');
          return;
        }
        zxingReader = new ZXing.BrowserMultiFormatReader();
        try {
          active = true;
          $start.disabled = true;
          $stop.disabled = false;
          $copy.disabled = true;
          $result.textContent = 'Scanning...';

          await zxingReader.decodeFromVideoDevice(undefined, $video, (result, err) => {
            if (result) {
              $result.textContent = `Value: ${result.text} (Format: ${result.barcodeFormat})`;
              $copy.disabled = false;
            }
          });
        } catch (err){
          console.error(err);
          alert('Could not start camera: ' + err.message);
        }
      }

      function stopCamera(){
        if (zxingReader){
          zxingReader.reset();
        }
        active = false;
        $start.disabled = false;
        $stop.disabled = true;
        $result.textContent = 'No code yet';
        $copy.disabled = true;
      }

      $start.addEventListener('click', startCamera);
      $stop.addEventListener('click', stopCamera);
      $copy.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText($result.textContent);
          $copy.textContent = '‚úÖ Copied';
          setTimeout(() => $copy.textContent = 'üìã Copy', 1200);
        } catch{}
      });

      document.addEventListener('visibilitychange', () => { if (document.hidden) stopCamera(); });
    })();
  </script>
</body>
</html>
